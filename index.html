<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>å°è‚¡è¶¨å‹¢AIå°ˆæ¥­åˆ†æåŠ©æ‰‹ - Joseph PAI 2025 (Final v21)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
    <style>
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; color: white; font-family: 'Microsoft JhengHei',sans-serif; }
        .container { max-width: 1350px; }
        .card { background: rgba(255,255,255,0.12); backdrop-filter: blur(12px); border: none; box-shadow: 0 8px 32px rgba(0,0,0,0.4); }
        .score-big { font-size: 6.5rem; font-weight: 900; text-shadow: 0 6px 15px rgba(0,0,0,0.6); }
        .badge-pos { background: #28a745; }
        .badge-neg { background: #dc3545; }
        .weight-input { width: 80px; text-align: center; font-weight: bold; background:#fff; color:#333; }
        .summary { background: rgba(0,0,0,0.4); padding: 30px; border-radius: 15px; margin: 30px 0; }
        footer { margin-top: 80px; padding: 30px; text-align: center; color: rgba(255,255,255,0.8); }
        .debug-log { max-height: 500px; overflow-y: auto; background: rgba(0,0,0,0.8); color: #0f0; font-family: monospace; padding: 15px; border-radius: 8px; }
        .token-status { font-weight: bold; }
        .data-source { font-size: 0.8rem; color: #ffc107; margin-top: 10px; }
        .date-range-input { width: 120px; }
        .manual-input { width: 100%; text-align: center; font-size: 1rem; }
        .explanation { background: white; color: black; padding: 15px; border-radius: 8px; margin-top: 10px; font-size: 0.9rem; }
        .explanation h6 { color: #8B0000; margin-bottom: 5px; font-weight: bold; }
        .manual-input-cell { padding: 5px !important; width: 100px; }
        .manual-label { font-size: 1rem; color: #ffc107; font-weight: bold; }
        .table-header-red { background-color: #8B0000; color: white; }
        .period-select { width: 110px; font-size: 0.9rem; cursor: pointer; }
        .financial-period { background-color: rgba(255, 255, 255, 0.1); padding: 10px; border-radius: 5px; margin-bottom: 10px; }
        .basis-box { background: rgba(0,0,0,0.3); border-left: 4px solid #ffc107; padding: 15px; margin-top: 20px; border-radius: 4px; }
        td, th { vertical-align: middle; }
        .stock-search { max-width: 300px; }
        
        /* æ–°å¢æ ·å¼ */
        .ai-analysis-section { margin-bottom: 20px; }
        .ai-analysis-toggle { cursor: pointer; }
        .ai-analysis-content { margin-top: 15px; }
        .chart-container { margin: 20px 0; padding: 15px; background: rgba(255,255,255,0.9); border-radius: 10px; }
        .data-section { margin: 15px 0; padding: 10px; }
        
        /* å…¬å¸ç±»å‹é€‰æ‹©æ ·å¼ */
        .company-type-badge { font-size: 0.75rem; padding: 2px 6px; }
        .company-type-select { width: 120px; }
        .detected-type { margin-left: 8px; font-size: 0.85rem; }
        .type-listed { color: #28a745; }
        .type-emerging { color: #ffc107; }
        .type-unknown { color: #6c757d; }
        
        /* æ–°å¢æ ·å¼ */
        .validation-error { border-color: #dc3545 !important; box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25); }
        .validation-success { border-color: #28a745 !important; }
        .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        .retry-btn { margin-left: 10px; }
        
        /* æ–°å¢ï¼šè‚¡ç¥¨é€‰æ‹©ç›¸å…³æ ·å¼ */
        .stock-select-tab { background: rgba(255,255,255,0.1); border-radius: 8px; padding: 15px; margin-bottom: 15px; }
        .stock-select-tab .nav-link { color: rgba(255,255,255,0.8); }
        .stock-select-tab .nav-link.active { background: rgba(255,255,255,0.2); color: white; font-weight: bold; }
        .hot-stock-btn { margin: 2px; font-size: 0.85rem; }
        .stock-search-section { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; }
        
        /* æ–°å¢ï¼šæœå°‹æ­·å²æ¨£å¼ */
        .search-history-item { cursor: pointer; padding: 5px 10px; border-radius: 4px; margin: 2px 0; }
        .search-history-item:hover { background: rgba(255,255,255,0.1); }
        .quick-search-dropdown { max-height: 200px; overflow-y: auto; }
        
        /* æ–°å¢ï¼šåŠ è¼‰ä¸­æ¨£å¼ */
        .loading-spinner { display: inline-block; width: 1rem; height: 1rem; vertical-align: text-bottom; border: 0.15em solid currentColor; border-right-color: transparent; border-radius: 50%; animation: spinner-border .75s linear infinite; }
        @keyframes spinner-border { to { transform: rotate(360deg); } }
        
        /* æ–°å¢ï¼šæœç´¢ç¢ºèªæŒ‰éˆ•æ¨£å¼ */
        .search-confirm-btn { margin-top: 5px; }
        
        /* æ–°å¢ï¼šæ¨¡ç³ŠæŸ¥è©¢ä¸‹æ‹‰é¸å–®æ¨£å¼ */
        .search-suggestions {
            position: absolute;
            z-index: 1000;
            width: 100%;
            max-height: 200px;
            overflow-y: auto;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }
        .search-suggestion-item {
            padding: 8px 12px;
            cursor: pointer;
            color: #333;
            border-bottom: 1px solid #f0f0f0;
        }
        .search-suggestion-item:hover {
            background-color: #f5f5f5;
        }
        .search-suggestion-item .stock-code {
            font-weight: bold;
            color: #007bff;
        }
        .search-suggestion-item .stock-name {
            margin-left: 8px;
            color: #666;
        }
        .search-suggestion-item .stock-type {
            float: right;
            font-size: 0.8rem;
            padding: 2px 6px;
            border-radius: 3px;
        }
        .search-suggestion-item .type-listed {
            background-color: #28a745;
            color: white;
        }
        .search-suggestion-item .type-otc {
            background-color: #007bff;
            color: white;
        }
        .search-suggestion-item .type-emerging {
            background-color: #ffc107;
            color: #212529;
        }
        
        /* ä¿®æ”¹çš„æ ·å¼ï¼šåˆ†ææ™‚é–“ç¯„åœå¸ƒå±€ - éŸ¿æ‡‰å¼è¨­è¨ˆ */
        .date-range-container {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 10px;
            justify-content: flex-start;
        }
        .date-range-label {
            flex: 0 0 auto;
            margin-right: 5px;
        }
        .date-range-select {
            flex: 0 0 auto;
        }
        .date-range-custom {
            flex: 1 1 auto;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 5px;
        }
        .analyze-btn-gold {
            flex: 0 0 auto;
            background-color: #ffc107 !important;
            border-color: #ffc107 !important;
            color: #212529 !important;
            font-weight: bold;
            padding-left: 20px;
            padding-right: 20px;
            min-width: 120px;
            white-space: nowrap;
        }
        .analyze-btn-gold:hover {
            background-color: #e0a800 !important;
            border-color: #e0a800 !important;
        }
        
        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 1200px) {
            .date-range-container {
                gap: 8px;
            }
            .date-range-custom {
                gap: 8px;
            }
        }
        
        @media (max-width: 992px) {
            .date-range-container {
                flex-direction: column;
                align-items: stretch;
                gap: 10px;
            }
            .date-range-label {
                text-align: center;
                margin-right: 0;
                margin-bottom: 5px;
            }
            .date-range-select {
                width: 100%;
            }
            .date-range-custom {
                width: 100%;
                justify-content: center;
                margin-top: 5px;
            }
            .analyze-btn-gold {
                width: 100%;
                margin-top: 10px;
            }
        }
        
        @media (max-width: 768px) {
            .date-range-custom {
                flex-direction: column;
                align-items: stretch;
            }
            .date-range-custom .form-control {
                width: 100%;
            }
            .date-range-custom span {
                text-align: center;
                margin: 5px 0;
            }
        }
        
        @media (max-width: 576px) {
            .date-range-select select {
                font-size: 0.9rem;
            }
            .date-range-custom input {
                font-size: 0.9rem;
            }
            .analyze-btn-gold {
                padding: 10px 15px;
                font-size: 1rem;
            }
        }
        
        /* AI åˆ†æåŠ©æ‰‹æ¨™é¡ŒèƒŒæ™¯æ”¹ç‚ºæ·±ç¶ è‰² */
        .ai-analysis-header {
            background-color: #198754 !important; /* æ·±ç¶ è‰² */
        }
        
        /* æ•´é«”éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 768px) {
            .container {
                padding-left: 10px;
                padding-right: 10px;
            }
            .score-big {
                font-size: 4rem;
            }
            .card-body {
                padding: 15px;
            }
            .table-responsive {
                font-size: 0.9rem;
            }
        }
        
        @media (max-width: 576px) {
            .score-big {
                font-size: 3rem;
            }
            h1 {
                font-size: 1.5rem;
            }
            h2 {
                font-size: 1.3rem;
            }
            .btn-group.w-100 {
                flex-wrap: wrap;
            }
            .btn-group.w-100 .btn {
                flex: 1 0 auto;
                margin-bottom: 5px;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
<div class="container py-5">

    <h1 class="text-center mb-2">å°è‚¡è¶¨å‹¢AIå°ˆæ¥­åˆ†æåŠ©æ‰‹</h1>
    <p class="text-center text-white-50 mb-5">Joseph PAI 2025 11/26 å°ˆæ¥­è©•åˆ†è©³è§£ç‰ˆ â€¢ Netlify Functions + TWSE/TPEx API</p>

    <div class="row justify-content-center mb-4">
        <div class="col-md-8">
            <!-- ä¿®æ”¹å¾Œçš„ Token è¼¸å…¥å€åŸŸ -->
            <div class="mb-3">
                <label class="form-label text-white-50 mb-2">FinMind Tokenï¼ˆé¸å¡«ï¼‰</label>
                <div class="input-group">
                    <input type="text" id="tokenInput" class="form-control bg-white text-dark" placeholder="è²¼ä¸Š Token æˆ–ç•™ç©ºä½¿ç”¨å…¬é–‹è³‡æ–™">
                    <button class="btn btn-danger fw-bold" id="saveToken">å„²å­˜</button>
                </div>
            </div>
            <small class="text-white-50">å…è²»è¨»å†Š â†’ <a href="https://finmindtrade.com/analysis/#/account/register" target="_blank" class="text-warning">FinMindï¼ˆ30ç§’ï¼‰</a> ï½œ æˆ–ç›´æ¥ä½¿ç”¨è­‰äº¤æ‰€+è§€æ¸¬ç«™å…¬é–‹è³‡æ–™</small>
            <div id="tokenStatus" class="token-status mt-2"></div>
        </div>
    </div>

    <!-- å…¬å¸é¡å‹èˆ‡è‚¡ç¥¨é¸æ“‡å€åŸŸ -->
    <div class="row justify-content-center mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-danger text-white">
                    <strong>ğŸ“Š è‚¡ç¥¨é¸æ“‡</strong>
                </div>
                <div class="card-body">
                    <!-- å…¬å¸é¡å‹é¸æ“‡ -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-12">
                            <label class="form-label text-white-50"><strong>å…¬å¸é¡å‹ï¼ˆå¿…é¸ï¼‰</strong></label>
                            <div class="btn-group w-100" role="group" id="companyTypeGroup">
                                <input type="radio" class="btn-check" name="companyType" id="companyTypeAuto" value="auto" autocomplete="off" checked>
                                <label class="btn btn-danger" for="companyTypeAuto">è‡ªå‹•æª¢æ¸¬</label>
                                
                                <input type="radio" class="btn-check" name="companyType" id="companyTypeListed" value="listed" autocomplete="off">
                                <label class="btn btn-primary" for="companyTypeListed">ä¸Šå¸‚å…¬å¸</label>
                                
                                <input type="radio" class="btn-check" name="companyType" id="companyTypeOTC" value="otc" autocomplete="off">
                                <label class="btn btn-info" for="companyTypeOTC">ä¸Šæ«ƒå…¬å¸</label>
                                
                                <input type="radio" class="btn-check" name="companyType" id="companyTypeEmerging" value="emerging" autocomplete="off">
                                <label class="btn btn-warning" for="companyTypeEmerging">èˆˆæ«ƒå…¬å¸</label>
                            </div>
                            <div id="detectedTypeDisplay" class="detected-type mt-2"></div>
                        </div>
                    </div>

                    <!-- ä¿®æ”¹å¾Œçš„ç‰ˆé¢é †åº -->
                    <!-- 1ã€è¼¸å…¥ä»£ç¢¼æˆ–åç¨±æœå°‹ -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-8">
                            <label class="form-label text-white-50"><strong>1. è¼¸å…¥ä»£ç¢¼æˆ–åç¨±æœå°‹</strong></label>
                            <div class="input-group position-relative">
                                <input type="text" id="searchStockInput" class="form-control" placeholder="è¼¸å…¥ä»£ç¢¼æˆ–åç¨±æœå°‹...">
                                <button class="btn btn-danger text-white fw-bold" id="confirmSearchBtn">ç¢ºèª</button>
                                <!-- æ¨¡ç³ŠæŸ¥è©¢å»ºè­°ä¸‹æ‹‰é¸å–® -->
                                <div id="searchSuggestions" class="search-suggestions"></div>
                            </div>
                            <small class="text-white-50 d-block mt-1">è¼¸å…¥è‚¡ç¥¨ä»£ç¢¼æˆ–å…¬å¸åç¨±ï¼Œé»æ“Š"ç¢ºèª"é€²è¡Œå³æ™‚æœå°‹</small>
                        </div>
                    </div>

                    <!-- 2ã€é¸æ“‡è‚¡ç¥¨ -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-8">
                            <label class="form-label text-white-50"><strong>2. é¸æ“‡è‚¡ç¥¨</strong></label>
                            <select id="stockSelect" class="form-select" required>
                                <option value="">è«‹é¸æ“‡æˆ–æœå°‹è‚¡ç¥¨</option>
                            </select>
                            <div id="stockSelectLoading" class="mt-2" style="display: none;">
                                <small class="text-warning"><span class="loading-spinner"></span> è¼‰å…¥è‚¡ç¥¨æ¸…å–®ä¸­...</small>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label text-white-50"><strong>3. ç¢ºèª</strong></label>
                            <button class="btn btn-primary text-white fw-bold w-100" id="confirmSelectionBtn">ç¢ºèªé¸æ“‡</button>
                        </div>
                    </div>

                    <!-- 4ã€é¸æ“‡é¡è‚¡ï¼ˆåƒ…ä¸Šå¸‚å…¬å¸å¯ç”¨ï¼‰ -->
                    <div class="row g-3 mb-4" id="categorySection">
                        <div class="col-md-8">
                            <label class="form-label text-white-50"><strong>4. é¸æ“‡é¡è‚¡ï¼ˆåƒ…ä¸Šå¸‚å…¬å¸å¯ç”¨ï¼‰</strong></label>
                            <select id="stockCategory" class="form-select">
                                <option value="all">å…¨éƒ¨é¡è‚¡</option>
                            </select>
                            <small class="text-white-50">ç•¶é¸æ“‡ã€Œä¸Šæ«ƒ/èˆˆæ«ƒå…¬å¸ã€æ™‚åœç”¨</small>
                        </div>
                    </div>

                    <!-- 5ã€é¸æ“‡è‚¡ç¥¨ï¼ˆä¸Šå¸‚å…¬å¸ï¼‰ -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-8">
                            <label class="form-label text-white-50"><strong>5. é¸æ“‡è‚¡ç¥¨ï¼ˆä¸Šå¸‚å…¬å¸ï¼‰</strong></label>
                            <select id="listedStockSelect" class="form-select">
                                <option value="">è«‹å…ˆé¸æ“‡é¡è‚¡</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label text-white-50"><strong>6. ç¢ºèª</strong></label>
                            <button class="btn btn-primary text-white fw-bold w-100" id="confirmListedSelectionBtn">ç¢ºèªé¸æ“‡</button>
                        </div>
                    </div>

                    <!-- 7ã€å¿«é€Ÿæœå°‹ -->
                    <div class="row g-3 mb-4">
                        <div class="col-md-8">
                            <label class="form-label text-white-50"><strong>7. å¿«é€Ÿæœå°‹</strong></label>
                            <select id="quickSearchSelect" class="form-select">
                                <option value="">é¸æ“‡ç†±é–€è‚¡ç¥¨æˆ–æœå°‹è¨˜éŒ„...</option>
                                <!-- æœå°‹æ­·å²å’Œç†±é–€è‚¡ç¥¨å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label text-white-50"><strong>8. é¸æ“‡</strong></label>
                            <button class="btn btn-primary text-white fw-bold w-100" id="applyQuickSearch">é¸æ“‡</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- åˆ†ææ™‚é–“ç¯„åœ - å·²ä¿®æ”¹ç‚ºéŸ¿æ‡‰å¼è¨­è¨ˆ -->
    <div class="row justify-content-center mb-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-body">
                    <form id="analyzeForm">
                        <div class="date-range-container">
                            <div class="date-range-label">
                                <label class="form-label text-white-50 mb-0"><strong>åˆ†ææ™‚é–“ç¯„åœï¼š</strong></label>
                            </div>
                            <div class="date-range-select">
                                <select id="dateRange" class="form-select">
                                    <option value="30">æœ€è¿‘30å¤©</option>
                                    <option value="60" selected>æœ€è¿‘60å¤©</option>
                                    <option value="90">æœ€è¿‘90å¤©</option>
                                    <option value="180">æœ€è¿‘åŠå¹´</option>
                                    <option value="365">æœ€è¿‘ä¸€å¹´</option>
                                </select>
                            </div>
                            <div class="date-range-custom">
                                <span class="text-white-50">æˆ–è‡ªè¨‚ï¼š</span>
                                <input type="date" id="startDate" class="form-control" placeholder="é–‹å§‹æ—¥æœŸ">
                                <span class="text-white-50">åˆ°</span>
                                <input type="date" id="endDate" class="form-control" placeholder="çµæŸæ—¥æœŸ">
                            </div>
                            <button class="btn analyze-btn-gold fw-bold" type="submit">ç«‹å³åˆ†æ</button>
                        </div>
                    </form>
                    
                    <!-- æ•¸æ“šä¾†æºé¡¯ç¤º -->
                    <div id="dataSourceInfo" class="mt-3">
                        <small class="text-white-50">æ•¸æ“šä¾†æº: <span id="currentDataSource">æº–å‚™ä¸­...</span></small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AI åˆ†æåŠŸèƒ½å€åŸŸ - é»˜èªéš±è— -->
    <div class="row justify-content-center mb-4 ai-analysis-section">
        <div class="col-md-12">
            <div class="card text-dark">
                <div class="card-header ai-analysis-header text-white ai-analysis-toggle" data-bs-toggle="collapse" data-bs-target="#aiAnalysisContent">
                    <strong>ğŸ” AI é›™é‡åˆ†æåŠ©æ‰‹</strong>
                    <small class="float-end">é»æ“Šå±•é–‹/æ”¶åˆ | åŒæ™‚åˆ†ææ¶ˆæ¯é¢èˆ‡é¢¨éšªé¢</small>
                </div>
                <div class="card-body collapse" id="aiAnalysisContent">
                    <div class="row g-3 align-items-center">
                        <div class="col-md-4">
                            <label class="form-label">AIå¹³å°é¸æ“‡</label>
                            <select id="aiPlatform" class="form-select">
                                <option value="deepseek">DeepSeek (æ¨è–¦)</option>
                                <option value="gpt">ChatGPT (OpenAI)</option>
                                <option value="gemini">Gemini (Google)</option>
                                <option value="claude">Claude (Anthropic)</option>
                                <option value="grok">Grok (xAI)</option>
                            </select>
                            <small class="text-muted">
                                <a href="#" id="getApiLink" class="text-primary">ğŸ“Œ ç²å–API Key</a>
                            </small>
                        </div>
                        <div class="col-md-5">
                            <label class="form-label">API Key</label>
                            <div class="input-group">
                                <input type="password" id="aiApiKey" class="form-control" placeholder="è¼¸å…¥é¸æ“‡å¹³å°çš„ API Key">
                                <button class="btn btn-outline-danger" type="button" id="verifyAiKey">é©—è­‰</button>
                            </div>
                            <small class="text-muted" id="apiKeyHint">è«‹è¼¸å…¥æœ‰æ•ˆçš„API Key</small>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">åˆ†ææ¨¡å¼</label>
                            <div class="d-flex flex-column">
                                <div class="form-check mb-2">
                                    <input class="form-check-input" type="checkbox" id="parallelAnalysis" checked>
                                    <label class="form-check-label" for="parallelAnalysis">
                                        ğŸš€ ä¸¦è¡Œé›™é‡åˆ†æ
                                    </label>
                                </div>
                                <small class="text-muted">åŒæ™‚é€²è¡Œæ¶ˆæ¯é¢èˆ‡é¢¨éšªé¢åˆ†æ</small>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="d-flex gap-2 flex-wrap">
                                <button class="btn btn-danger" id="aiAnalyzeBtn" disabled>
                                    <span class="spinner-border spinner-border-sm me-2" id="aiSpinner" style="display: none;"></span>
                                    ğŸ¤– é–‹å§‹é›™é‡åˆ†æ
                                </button>
                                <button class="btn btn-outline-secondary" id="clearAiAnalysis">
                                    ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰åˆ†æ
                                </button>
                                <button class="btn btn-outline-danger" id="testConnectionBtn">
                                    ğŸ”— æ¸¬è©¦é€£ç·š
                                </button>
                                <button class="btn btn-outline-danger" id="singleNewsAnalysis" disabled>
                                    ğŸ“° åƒ…æ¶ˆæ¯é¢åˆ†æ
                                </button>
                                <button class="btn btn-outline-danger" id="singleRiskAnalysis" disabled>
                                    âš ï¸ åƒ…é¢¨éšªé¢åˆ†æ
                                </button>
                                <div id="aiKeyStatus" class="ms-2 align-self-center"></div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¸¦è¡Œåˆ†æé€²åº¦æŒ‡ç¤ºå™¨ -->
                    <div id="parallelProgress" class="mt-3" style="display: none;">
                        <div class="progress" style="height: 25px;">
                            <div id="newsProgress" class="progress-bar bg-danger" role="progressbar" style="width: 0%;">
                                æ¶ˆæ¯é¢åˆ†æä¸­...
                            </div>
                            <div id="riskProgress" class="progress-bar bg-warning" role="progressbar" style="width: 0%;">
                                é¢¨éšªé¢åˆ†æä¸­...
                            </div>
                        </div>
                        <div class="d-flex justify-content-between mt-2">
                            <small id="newsStatus">ğŸ”„ ç­‰å¾…é–‹å§‹</small>
                            <small id="riskStatus">ğŸ”„ ç­‰å¾…é–‹å§‹</small>
                        </div>
                    </div>

                    <!-- AI é›™é‡åˆ†æçµæœé¡¯ç¤º -->
                    <div id="aiAnalysisResult" class="mt-4" style="display: none;">
                        <div class="row">
                            <!-- æ¶ˆæ¯é¢åˆ†æçµæœå€å¡Š -->
                            <div class="col-md-6 mb-3">
                                <div class="card h-100">
                                    <div class="card-header bg-danger text-white">
                                        <strong>ğŸ“° æ¶ˆæ¯é¢åˆ†æçµæœ</strong>
                                        <div class="float-end">
                                            <span id="newsScoreBadge" class="badge bg-light text-dark">--/10</span>
                                            <button class="btn btn-sm btn-light ms-2" onclick="copyToClipboard('newsAnalysisContent')">ğŸ“‹</button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="border rounded p-3 bg-light" style="max-height: 400px; overflow-y: auto;">
                                            <pre id="newsAnalysisContent" style="white-space: pre-wrap; font-family: inherit; margin: 0;">è«‹å…ˆé€²è¡Œåˆ†æ...</pre>
                                        </div>
                                        <div class="mt-3">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <strong>è©•åˆ†: </strong>
                                                <span id="newsScoreDisplay" class="fs-4 fw-bold">--</span>
                                            </div>
                                            <div class="mt-2">
                                                <strong>å»ºè­°: </strong>
                                                <span id="newsComment" class="text-muted">--</span>
                                            </div>
                                            <button class="btn btn-sm btn-danger w-100 mt-2" id="applyNewsScore">
                                                âœ… æ‡‰ç”¨æ¶ˆæ¯é¢è©•åˆ†
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- é¢¨éšªé¢åˆ†æçµæœå€å¡Š -->
                            <div class="col-md-6 mb-3">
                                <div class="card h-100">
                                    <div class="card-header bg-warning text-dark">
                                        <strong>âš ï¸ é¢¨éšªé¢åˆ†æçµæœ</strong>
                                        <div class="float-end">
                                            <span id="riskScoreBadge" class="badge bg-light text-dark">--/10</span>
                                            <button class="btn btn-sm btn-light ms-2" onclick="copyToClipboard('riskAnalysisContent')">ğŸ“‹</button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="border rounded p-3 bg-light" style="max-height: 400px; overflow-y: auto;">
                                            <pre id="riskAnalysisContent" style="white-space: pre-wrap; font-family: inherit; margin: 0;">è«‹å…ˆé€²è¡Œåˆ†æ...</pre>
                                        </div>
                                        <div class="mt-3">
                                            <div class="d-flex justify-content-between align-items-center">
                                                <strong>è©•åˆ†: </strong>
                                                <small class="text-muted">(+é¢¨éšªä½/-é¢¨éšªé«˜)</small>
                                            </div>
                                            <span id="riskScoreDisplay" class="fs-4 fw-bold">--</span>
                                            <div class="mt-2">
                                                <strong>å»ºè­°: </strong>
                                                <span id="riskComment" class="text-muted">--</span>
                                            </div>
                                            <button class="btn btn-sm btn-danger w-100 mt-2" id="applyRiskScore">
                                                âœ… æ‡‰ç”¨é¢¨éšªé¢è©•åˆ†
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- åˆä½µè©•åˆ†å€åŸŸ -->
                        <div class="row mt-3">
                            <div class="col-md-12">
                                <div class="card">
                                    <div class="card-header bg-danger text-white">
                                        <strong>ğŸ“Š ç¶œåˆåˆ†ææ‘˜è¦</strong>
                                    </div>
                                    <div class="card-body">
                                        <div class="row text-center">
                                            <div class="col-md-6">
                                                <h6>æ¶ˆæ¯é¢è©•åˆ†</h6>
                                                <div id="finalNewsScore" class="fs-1 fw-bold text-danger">--</div>
                                                <div id="finalNewsComment" class="text-muted">--</div>
                                                <small class="text-muted">(+åˆ©å¤š/-åˆ©ç©º)</small>
                                            </div>
                                            <div class="col-md-6">
                                                <h6>é¢¨éšªé¢è©•åˆ†</h6>
                                                <div id="finalRiskScore" class="fs-1 fw-bold text-warning">--</div>
                                                <div id="finalRiskComment" class="text-muted">--</div>
                                                <small class="text-muted">(+é¢¨éšªä½/-é¢¨éšªé«˜)</small>
                                            </div>
                                        </div>
                                        <div class="text-center mt-3">
                                            <button class="btn btn-danger" id="applyBothScores">
                                                âœ… åŒæ™‚æ‡‰ç”¨å…©é …è©•åˆ†
                                            </button>
                                            <small class="text-muted d-block mt-2">å°‡åŒæ™‚æ›´æ–°æ¶ˆæ¯é¢(10%)å’Œé¢¨éšªé¢(10%)çš„è©•åˆ†</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="text-center mb-4">
        <button class="btn btn-outline-light" type="button" data-bs-toggle="collapse" data-bs-target="#debugLog">
            é¡¯ç¤º/éš±è— é™¤éŒ¯æ—¥èªŒ
        </button>
    </div>

    <div class="collapse" id="debugLog">
        <div class="card mb-4">
            <div class="card-body p-3">
                <pre id="logContent" class="debug-log"></pre>
            </div>
            <div class="card-footer">
                <button class="btn btn-sm btn-outline-danger" onclick="document.getElementById('logContent').textContent = '';">æ¸…é™¤æ—¥èªŒ</button>
            </div>
        </div>
    </div>

    <div id="loading" class="text-center my-5" style="display:none;">
        <div class="spinner-border text-warning" style="width:6rem;height:6rem;"></div>
        <h3 class="mt-4">æ­£åœ¨æŠ“å–æœ€æ–°è³‡æ–™ (å¤šç¶­åº¦åˆ†æä¸­)â€¦</h3>
    </div>

    <div id="result" style="display:none;"></div>

</div>

<footer>Â© 2025 Joseph PAI. All Rights Reserved. | è³‡æ–™ä¾†æºï¼šå°ç£è­‰åˆ¸äº¤æ˜“æ‰€ (TWSE) + è­‰åˆ¸æ«ƒæª¯è²·è³£ä¸­å¿ƒ (TPEx) + FinMind + Yahoo Finance</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
// å®Œæ•´çš„JavaScriptä»£ç¢¼ä¿æŒä¸è®Šï¼Œå› è«‹æ±‚è¦æ±‚åªä¿®æ”¹CSSéƒ¨åˆ†
// é€™è£¡åªåŒ…å«CSSä¿®æ”¹ï¼Œå®Œæ•´JavaScriptä»£ç¢¼åœ¨åŸå§‹æ–‡ä»¶ä¸­
</script>
</body>
</html>